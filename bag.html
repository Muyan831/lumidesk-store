<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Your Bag | LumiDesk</title>
Â  Â  <style>
Â  Â  Â  Â  /* =========================================
Â  Â  Â  Â  Â  Â ğŸŒŸ å…¨å±€åŸºç¡€è®¾ç½® (Apple Style)
Â  Â  Â  Â  Â  Â ========================================= */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg: #ffffff; --text: #1d1d1f; --text-muted: #86868b;
Â  Â  Â  Â  Â  Â  --accent: #0071e3; --border: #d2d2d7; --bg-secondary: #f5f5f7;
Â  Â  Â  Â  Â  Â  --glass: rgba(255, 255, 255, 0.72);
Â  Â  Â  Â  Â  Â  --radius: 18px;
Â  Â  Â  Â  Â  Â  --accent-green: #34c759;Â 
Â  Â  Â  Â  Â  Â  --accent-red: #ff3b30;
Â  Â  Â  Â  }
Â  Â  Â  Â  * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
Â  Â  Â  Â  body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; background: var(--bg); color: var(--text); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Nav */
Â  Â  Â  Â  nav {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; width: 100%; height: 52px;
Â  Â  Â  Â  Â  Â  background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
Â  Â  Â  Â  Â  Â  z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-link { color: var(--text); text-decoration: none; font-size: 13px; font-weight: 500; cursor: pointer; }

Â  Â  Â  Â  /* Container */
Â  Â  Â  Â  .container { max-width: 800px; margin: 100px auto; padding: 0 24px; }
Â  Â  Â  Â  h1 { font-size: 40px; font-weight: 700; margin-bottom: 40px; }

Â  Â  Â  Â  /* Cart List */
Â  Â  Â  Â  .cart-item { display: flex; align-items: center; padding: 24px 0; border-bottom: 1px solid var(--border); }
Â  Â  Â  Â  .item-img { width: 80px; height: 80px; border-radius: 12px; background: var(--bg-secondary); object-fit: cover; margin-right: 20px; }
Â  Â  Â  Â  .item-info { flex: 1; }
Â  Â  Â  Â  .item-name { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
Â  Â  Â  Â  .item-price { color: var(--text-muted); font-size: 15px; }
Â  Â  Â  Â  .item-controls { display: flex; align-items: center; gap: 15px; margin-top: 8px; }
Â  Â  Â  Â  .qty-btn { width: 24px; height: 24px; border-radius: 50%; border: 1px solid var(--border); background: transparent; color: var(--text); cursor: pointer; display: flex; align-items: center; justify-content: center; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Summary & Promo Code */
Â  Â  Â  Â  .summary-section { margin-top: 40px; display: flex; flex-direction: column; align-items: flex-end; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .promo-box { display: flex; gap: 10px; margin-bottom: 10px; width: 100%; max-width: 320px; }
Â  Â  Â  Â  .promo-input { flex: 1; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 14px; outline: none; transition: border 0.3s; }
Â  Â  Â  Â  .promo-input:focus { border-color: var(--text); }
Â  Â  Â  Â  .promo-btn { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text); padding: 0 16px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: 0.3s; }
Â  Â  Â  Â  .promo-btn:hover { background: #e8e8ed; }
Â  Â  Â  Â  .promo-msg { font-size: 13px; font-weight: 600; min-height: 20px; margin-bottom: 20px; text-align: right; width: 100%; max-width: 320px; }

Â  Â  Â  Â  /* ä»·æ ¼æ˜ç»†é¢æ¿ */
Â  Â  Â  Â  .price-breakdown { text-align: right; width: 100%; max-width: 320px; border-top: 1px solid var(--border); padding-top: 20px; margin-bottom: 24px; }
Â  Â  Â  Â  .price-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px; color: var(--text-muted); transition: color 0.3s; }
Â  Â  Â  Â  .price-row.discount { color: var(--accent-green); font-weight: 500; }
Â  Â  Â  Â  .total-row { display: flex; justify-content: space-between; font-size: 24px; font-weight: 700; color: var(--text); margin-top: 12px; }

Â  Â  Â  Â  .checkout-btn { background: var(--text); color: white; padding: 16px 40px; border-radius: 40px; font-size: 16px; font-weight: 600; border: none; cursor: pointer; transition: 0.3s; width: 100%; max-width: 320px; }
Â  Â  Â  Â  .checkout-btn:hover { transform: scale(1.02); background: #000; }
Â  Â  Â  Â  .empty-msg { text-align: center; color: var(--text-muted); margin-top: 60px; font-size: 18px; }

Â  Â  Â  Â  /* =========================================
Â  Â  Â  Â  Â  Â ğŸš€ åµŒå…¥å¼å¼¹çª— (Modal) æ ·å¼
Â  Â  Â  Â  Â  Â ========================================= */
Â  Â  Â  Â  .modal-overlay {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px);
Â  Â  Â  Â  Â  Â  z-index: 2000; display: none; justify-content: center; align-items: center;
Â  Â  Â  Â  Â  Â  opacity: 0; transition: opacity 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-overlay.active { display: flex; opacity: 1; }

Â  Â  Â  Â  .modal-card {
Â  Â  Â  Â  Â  Â  background: white; width: 90%; max-width: 640px; height: 90vh;
Â  Â  Â  Â  Â  Â  border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  overflow: hidden; position: relative; display: flex; flex-direction: column;
Â  Â  Â  Â  Â  Â  transform: scale(0.95); transition: transform 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-overlay.active .modal-card { transform: scale(1); }

Â  Â  Â  Â  .modal-header {
Â  Â  Â  Â  Â  Â  padding: 15px 20px; border-bottom: 1px solid var(--border);
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.9); flex-shrink: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-title { font-weight: 600; font-size: 16px; }
Â  Â  Â  Â  .close-btn { background: #e5e5e5; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold; color: #555; font-size: 18px; display: flex; align-items: center; justify-content: center; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .iframe-container { flex: 1; overflow: hidden; position: relative; }
Â  Â  Â  Â  iframe { width: 100%; height: 100%; border: none; background: #fafafa; }

Â  Â  Â  Â  .modal-footer {
Â  Â  Â  Â  Â  Â  padding: 15px 20px; border-top: 1px solid var(--border); background: #f9f9f9; text-align: center; flex-shrink: 0; display: flex; flex-direction: column; gap: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .finish-btn { background: var(--accent-green); color: white; padding: 12px 24px; border-radius: 40px; font-size: 15px; font-weight: 600; border: none; cursor: pointer; width: 100%; transition: 0.2s; }
Â  Â  Â  Â  .finish-btn:hover { background: #28a745; transform: scale(1.02); }
Â  Â  Â  Â  .hint-text { font-size: 12px; color: var(--text-muted); }

Â  Â  </style>
</head>
<body id="mainBody">

<nav>
Â  Â  <a onclick="goBack()" class="nav-link">â† Continue Shopping</a>
</nav>

<div class="container">
Â  Â  <h1>Review your bag.</h1>
Â  Â  <div id="cartList"></div>
Â  Â Â 
Â  Â  <div class="summary-section" id="summarySection" style="display:none;">
Â  Â  Â  Â  <div class="promo-box">
Â  Â  Â  Â  Â  Â  <input type="text" id="promoCode" class="promo-input" placeholder="Promo code">
Â  Â  Â  Â  Â  Â  <button class="promo-btn" onclick="applyPromo()">Apply</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="promoMsg" class="promo-msg"></div>

Â  Â  Â  Â  <div class="price-breakdown">
Â  Â  Â  Â  Â  Â  <div class="price-row" id="subtotalRow">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Subtotal</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>RM <span id="subtotalAmount">0.00</span></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="price-row" id="shippingRow">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Shipping Fee</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>RM <span id="shippingAmount">5.90</span></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="price-row discount" id="discountRow" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Discount</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>- RM <span id="discountAmount">0.00</span></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="total-row">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Total</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>RM <span id="finalTotal">0.00</span></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="checkout-btn" onclick="openModal()">Proceed to Checkout</button>
Â  Â  </div>
</div>

<div class="modal-overlay" id="checkoutModal">
Â  Â  <div class="modal-card">
Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  <span class="modal-title">Secure Checkout</span>
Â  Â  Â  Â  Â  Â  <button class="close-btn" onclick="closeModal()">Ã—</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="iframe-container">
Â  Â  Â  Â  Â  Â  <iframe id="formFrame" src=""></iframe>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  <button class="finish-btn" onclick="finishTransaction()">I have submitted my order</button>
Â  Â  Â  Â  Â  Â  <span class="hint-text">Please click Submit in the form above first.</span>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
Â  Â  // --- iframe é˜²åµŒä¿®å¤ ---
Â  Â  if (window.self !== window.top) { document.getElementById('mainBody').classList.add('embedded'); }

Â  Â  // ============================================================
Â  Â  // âš ï¸ NOHA é…ç½®åŒºï¼šä½ çš„æœ€æ–° Google Form é“¾æ¥
Â  Â  // ============================================================
Â  Â  const FORM_CONFIG = {
Â  Â  Â  Â  baseUrl: "https://docs.google.com/forms/d/e/1FAIpQLSe9ni9r73kQ6tPgvUzL-3Fez0Twan5081k5qt0sKUy_HMhPTg/viewform",
Â  Â  Â  Â  fields: {
Â  Â  Â  Â  Â  Â  orderId:Â  Â  "entry.1569249656", // Order ID
Â  Â  Â  Â  Â  Â  items:Â  Â  Â  "entry.528642552",Â  // Cart Items
Â  Â  Â  Â  Â  Â  total:Â  Â  Â  "entry.421973586",Â  // Total
Â  Â  Â  Â  }
Â  Â  };

Â  Â  // --- ğŸš€ å…¨å±€å˜é‡ (åˆ†ç¦»é‡‘é¢æŠ˜æ‰£ä¸å…é‚®) ---
Â  Â  let appliedDiscountInfo = null; // ç”¨äºå­˜å‚¨é‡‘é¢ç±»æŠ˜æ‰£ (lumidesk2026, hariraya, cny123)
Â  Â  let isFreeShipping = false;Â  Â  Â // ç”¨äºå­˜å‚¨æ˜¯å¦å…è¿è´¹ (freeship)
Â  Â  let calculatedSubtotal = 0;
Â  Â  let calculatedShipping = 5.90;Â Â 
Â  Â  let calculatedDiscount = 0;
Â  Â  let calculatedFinalTotal = 0;

Â  Â  // --- åŠ è½½è´­ç‰©è½¦ ---
Â  Â  function loadCart() {
Â  Â  Â  Â  const cart = JSON.parse(localStorage.getItem('lumi_cart') || '[]');
Â  Â  Â  Â  const list = document.getElementById('cartList');
Â  Â  Â  Â  const summary = document.getElementById('summarySection');
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (cart.length === 0) {
Â  Â  Â  Â  Â  Â  list.innerHTML = `<div class="empty-msg">Your bag is empty.</div>`;
Â  Â  Â  Â  Â  Â  summary.style.display = 'none';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  calculatedSubtotal = 0;
Â  Â  Â  Â  list.innerHTML = cart.map(item => {
Â  Â  Â  Â  Â  Â  const lineTotal = item.price * item.qty;
Â  Â  Â  Â  Â  Â  calculatedSubtotal += lineTotal;
Â  Â  Â  Â  Â  Â  const imgSrc = item.img || 'https://via.placeholder.com/150';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="cart-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${imgSrc}" class="item-img" onerror="this.src='https://via.placeholder.com/150?text=LumiDesk'">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-name">${item.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-price">RM ${item.price.toFixed(2)} x ${item.qty}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="qty-btn" onclick="updateQty('${item.id}', -1)">âˆ’</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${item.qty}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="qty-btn" onclick="updateQty('${item.id}', 1)">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:600; font-size: 16px;">RM ${lineTotal.toFixed(2)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }).join('');

Â  Â  Â  Â  summary.style.display = 'flex';
Â  Â  Â  Â  calculateTotals();
Â  Â  }

Â  Â  // --- æ›´æ–°æ•°é‡ ---
Â  Â  function updateQty(id, delta) {
Â  Â  Â  Â  let cart = JSON.parse(localStorage.getItem('lumi_cart'));
Â  Â  Â  Â  const item = cart.find(i => i.id === id);
Â  Â  Â  Â  if (item) {
Â  Â  Â  Â  Â  Â  item.qty += delta;
Â  Â  Â  Â  Â  Â  if (item.qty <= 0) cart = cart.filter(i => i.id !== id);
Â  Â  Â  Â  Â  Â  localStorage.setItem('lumi_cart', JSON.stringify(cart));
Â  Â  Â  Â  Â  Â  loadCart();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- ğŸš€ åº”ç”¨æŠ˜æ‰£ç é€»è¾‘ (åŒé€šé“å åŠ ç³»ç»Ÿ) ---
Â  Â  function applyPromo() {
Â  Â  Â  Â  const inputBox = document.getElementById('promoCode');
Â  Â  Â  Â  const input = inputBox.value.trim().toLowerCase();
Â  Â  Â  Â  const msg = document.getElementById('promoMsg');

Â  Â  Â  Â  if (input === '') {
Â  Â  Â  Â  Â  Â  // å¦‚æœç•™ç©ºå¹¶ç‚¹å‡» Applyï¼Œæ¸…ç©ºæ‰€æœ‰ä¼˜æƒ 
Â  Â  Â  Â  Â  Â  appliedDiscountInfo = null;
Â  Â  Â  Â  Â  Â  isFreeShipping = false;
Â  Â  Â  Â  Â  Â  msg.style.color = "var(--text-muted)";
Â  Â  Â  Â  Â  Â  msg.innerText = 'All promo codes cleared. Enter blank to clear.';
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  else if (input === 'freeship') {
Â  Â  Â  Â  Â  Â  isFreeShipping = true;
Â  Â  Â  Â  Â  Â  inputBox.value = ''; // è‡ªåŠ¨æ¸…ç©ºè¾“å…¥æ¡†ï¼Œæ–¹ä¾¿è¾“å…¥ä¸‹ä¸€ä¸ª
Â  Â  Â  Â  Â  Â  showActivePromos(msg);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  else if (input === 'lumidesk2026') {
Â  Â  Â  Â  Â  Â  appliedDiscountInfo = { code: 'LUMIDESK2026', type: 'percent', val: 0.05 };
Â  Â  Â  Â  Â  Â  inputBox.value = '';Â 
Â  Â  Â  Â  Â  Â  showActivePromos(msg);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  else if (input === 'hariraya') {
Â  Â  Â  Â  Â  Â  appliedDiscountInfo = { code: 'HARIRAYA', type: 'fixed', val: 3.00 };
Â  Â  Â  Â  Â  Â  inputBox.value = '';Â 
Â  Â  Â  Â  Â  Â  showActivePromos(msg);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  else if (input === 'cny123') {
Â  Â  Â  Â  Â  Â  appliedDiscountInfo = { code: 'CNY123', type: 'fixed', val: 8.80 };
Â  Â  Â  Â  Â  Â  inputBox.value = '';Â 
Â  Â  Â  Â  Â  Â  showActivePromos(msg);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  msg.style.color = "var(--accent-red)";
Â  Â  Â  Â  Â  Â  msg.innerText = 'Invalid promo code.';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  calculateTotals();
Â  Â  }

Â  Â  // æ›´æ–°ç•Œé¢ä¸Šçš„æ´»åŠ¨æŠ˜æ‰£æç¤º
Â  Â  function showActivePromos(msgElement) {
Â  Â  Â  Â  let activeTags = [];
Â  Â  Â  Â  if (appliedDiscountInfo) activeTags.push(appliedDiscountInfo.code);
Â  Â  Â  Â  if (isFreeShipping) activeTags.push('FREESHIP');
Â  Â  Â  Â Â 
Â  Â  Â  Â  msgElement.style.color = "var(--accent-green)";
Â  Â  Â  Â  msgElement.innerText = `Active Promos: ${activeTags.join(' + ')}`;
Â  Â  }

Â  Â  // --- è®¡ç®—æ€»ä»·ä¸æŠ˜æ‰£ ---
Â  Â  function calculateTotals() {
Â  Â  Â  Â  // 1. è®¡ç®—è¿è´¹ (å¦‚æœæ¿€æ´»äº† freeship å°±æ˜¯ 0)
Â  Â  Â  Â  calculatedShipping = isFreeShipping ? 0 : 5.90;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. è®¡ç®—é‡‘é¢æŠ˜æ‰£
Â  Â  Â  Â  calculatedDiscount = 0;
Â  Â  Â  Â  if (appliedDiscountInfo) {
Â  Â  Â  Â  Â  Â  if (appliedDiscountInfo.type === 'percent') {
Â  Â  Â  Â  Â  Â  Â  Â  calculatedDiscount = calculatedSubtotal * appliedDiscountInfo.val;
Â  Â  Â  Â  Â  Â  } else if (appliedDiscountInfo.type === 'fixed') {
Â  Â  Â  Â  Â  Â  Â  Â  calculatedDiscount = appliedDiscountInfo.val;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. æœ€ç»ˆä»· = å•†å“æ€»ä»· + è¿è´¹ - æŠ˜æ‰£
Â  Â  Â  Â  calculatedFinalTotal = calculatedSubtotal + calculatedShipping - calculatedDiscount;
Â  Â  Â  Â  if (calculatedFinalTotal < 0) calculatedFinalTotal = 0; // é˜²æ­¢å€’æ‰£é’±

Â  Â  Â  Â  // --- æ›´æ–° UI ---
Â  Â  Â  Â  document.getElementById('subtotalAmount').innerText = calculatedSubtotal.toFixed(2);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // è¿è´¹ UI å˜åŒ–
Â  Â  Â  Â  const shipRow = document.getElementById('shippingRow');
Â  Â  Â  Â  const shipAmt = document.getElementById('shippingAmount');
Â  Â  Â  Â  if (isFreeShipping) {
Â  Â  Â  Â  Â  Â  shipRow.style.color = "var(--accent-green)";
Â  Â  Â  Â  Â  Â  shipRow.style.fontWeight = "600";
Â  Â  Â  Â  Â  Â  shipAmt.innerText = "0.00 (Free)";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  shipRow.style.color = "var(--text-muted)";
Â  Â  Â  Â  Â  Â  shipRow.style.fontWeight = "normal";
Â  Â  Â  Â  Â  Â  shipAmt.innerText = "5.90";
Â  Â  Â  Â  }

Â  Â  Â  Â  // æŠ˜æ‰£ UI å˜åŒ–
Â  Â  Â  Â  const discRow = document.getElementById('discountRow');
Â  Â  Â  Â  if (calculatedDiscount > 0) {
Â  Â  Â  Â  Â  Â  document.getElementById('discountAmount').innerText = calculatedDiscount.toFixed(2);
Â  Â  Â  Â  Â  Â  discRow.style.display = 'flex';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  discRow.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById('finalTotal').innerText = calculatedFinalTotal.toFixed(2);
Â  Â  }

Â  Â  // --- ğŸš€ æäº¤åˆ° Google Form ---
Â  Â  function openModal() {
Â  Â  Â  Â  const cart = JSON.parse(localStorage.getItem('lumi_cart') || '[]');
Â  Â  Â  Â  if (cart.length === 0) return;

Â  Â  Â  Â  // ç”Ÿæˆè®¢å•å·
Â  Â  Â  Â  const dateStr = new Date().toISOString().slice(0,10).replace(/-/g, "");
Â  Â  Â  Â  const randomSuffix = Math.random().toString(36).substring(2, 6).toUpperCase();
Â  Â  Â  Â  const orderId = `LD-${dateStr}-${randomSuffix}`;
Â  Â  Â  Â  const finalTotalString = calculatedFinalTotal.toFixed(2);

Â  Â  Â  Â  // ç»„è£…å‘ç»™ Google Form çš„æ˜ç»†
Â  Â  Â  Â  let cartString = cart.map(i => `${i.name} (x${i.qty}) = RM ${(i.price * i.qty).toFixed(2)}`).join("\n");Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  cartString += `\n\n---`;
Â  Â  Â  Â  cartString += `\nSubtotal: RM ${calculatedSubtotal.toFixed(2)}`;
Â  Â  Â  Â  cartString += `\nShipping: RM ${calculatedShipping.toFixed(2)}` + (isFreeShipping ? " (FREESHIP Applied)" : "");
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (calculatedDiscount > 0 && appliedDiscountInfo) {
Â  Â  Â  Â  Â  Â  cartString += `\nDiscount (${appliedDiscountInfo.code}): -RM ${calculatedDiscount.toFixed(2)}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // ç¼“å­˜ç»™ Receipt é¡µç”¨
Â  Â  Â  Â  localStorage.setItem('lumi_last_order', JSON.stringify({
Â  Â  Â  Â  Â  Â  id: orderId, total: finalTotalString, subtotal: calculatedSubtotal.toFixed(2),Â 
Â  Â  Â  Â  Â  Â  shipping: calculatedShipping.toFixed(2), discount: calculatedDiscount.toFixed(2),Â 
Â  Â  Â  Â  Â  Â  items: cart, date: new Date().toLocaleString()
Â  Â  Â  Â  }));

Â  Â  Â  Â  // æ‹¼æ¥ Google Form é“¾æ¥
Â  Â  Â  Â  const params = new URLSearchParams();
Â  Â  Â  Â  params.append("embedded", "true");Â 
Â  Â  Â  Â  params.append(FORM_CONFIG.fields.orderId, orderId);
Â  Â  Â  Â  params.append(FORM_CONFIG.fields.items, cartString);
Â  Â  Â  Â  params.append(FORM_CONFIG.fields.total, finalTotalString);Â 

Â  Â  Â  Â  const finalUrl = `${FORM_CONFIG.baseUrl}?${params.toString()}`;

Â  Â  Â  Â  // åŠ è½½å¼¹çª—
Â  Â  Â  Â  document.getElementById('formFrame').src = finalUrl;
Â  Â  Â  Â  document.getElementById('checkoutModal').classList.add('active');
Â  Â  }

Â  Â  function closeModal() {
Â  Â  Â  Â  document.getElementById('checkoutModal').classList.remove('active');
Â  Â  }

Â  Â  function finishTransaction() {
Â  Â  Â  Â  localStorage.removeItem('lumi_cart');Â 
Â  Â  Â  Â  loadCart();
Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  try { window.top.location.href = 'receipt.html'; }Â 
Â  Â  Â  Â  catch (e) { window.location.href = 'receipt.html'; }
Â  Â  }

Â  Â  function goBack() {
Â  Â  Â  Â  try { window.top.location.href = 'index.html'; }Â 
Â  Â  Â  Â  catch (e) { window.location.href = 'index.html'; }
Â  Â  }

Â  Â  loadCart();
</script>

</body>
</html>